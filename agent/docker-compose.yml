version: '3.8'

services:
  agent:
    build: .
    container_name: lumenmon-agent
    hostname: agent-${AGENT_ID:-default}
    volumes:
      - ./data/ssh:/home/metrics/.ssh:ro
    env_file:
      - ./data/.env
    environment:
      - CONSOLE_HOST=${CONSOLE_HOST:-lumenmon-console}
      - CONSOLE_PORT=${CONSOLE_PORT:-2345}
      - CONSOLE_USER=collector
      - AGENT_ID=${AGENT_ID:-${HOSTNAME:-agent}}
      # Sampling rates for different collectors
      - CPU_SAMPLE_HZ=10        # 10Hz for CPU
      - MEMORY_SAMPLE_HZ=1      # 1Hz for memory
      - DISK_SAMPLE_HZ=0.1      # Every 10s for disk
      - NETWORK_SAMPLE_HZ=0.5   # Every 2s for network
      - PROCESS_SAMPLE_HZ=0.2   # Every 5s for processes
      - SYSTEM_SAMPLE_HZ=0.017  # Every minute for system info
    command: |
      sh -c "
        echo '[agent] Starting...'
        exec /usr/local/bin/agent.sh
      "