services:
  agent:
    image: ${LUMENMON_IMAGE:-ghcr.io/chriopter/lumenmon-agent:latest}
    build: .
    container_name: lumenmon-agent
    hostname: agent-${AGENT_ID:-default}
    restart: unless-stopped
    networks:
      - lumenmon
    volumes:
      - ./data:/data
      - /etc/hostname:/host/etc/hostname:ro
    environment:
      - CONSOLE_HOST=${CONSOLE_HOST:-lumenmon-console}
      - MQTT_PORT=${MQTT_PORT:-8884}
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    command: |
      sh -c "
        echo '[agent] Starting...'
        exec /app/agent.sh
      "

networks:
  lumenmon:
    name: lumenmon-net
    driver: bridge