# Lumenmon SSH Configuration
# Secure per-agent isolation

# Global settings
Port 22
Protocol 2
HostKey /data/ssh/ssh_host_rsa_key
HostKey /data/ssh/ssh_host_ed25519_key

# Security settings
PasswordAuthentication no
PubkeyAuthentication yes
PermitRootLogin no
StrictModes no  # Needed for Docker volume mounts
PermitEmptyPasswords no

# Performance
UseDNS no
MaxStartups 30:50:100
ClientAliveInterval 30
ClientAliveCountMax 3

# Registration users - temporary, password auth
Match Group registration
    PasswordAuthentication yes
    ForceCommand /app/core/enrollment/gateway.sh
    MaxAuthTries 3
    MaxSessions 1
    AllowTcpForwarding no
    X11Forwarding no
    PermitTunnel no
    AllowAgentForwarding no

# Agent users - direct SQLite ingress
Match Group agents
    ForceCommand python3 /app/core/ingress/gateway.py
    AuthorizedKeysFile /data/agents/%u/.ssh/authorized_keys
    AllowTcpForwarding no
    X11Forwarding no
    PermitTunnel no
    AllowAgentForwarding no