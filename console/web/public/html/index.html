<!--
Main dashboard shell that includes all component partials via Jinja2.
Loads CSS, Chart.js vendor library, and initializes components. Served by Flask at /.
-->
<!DOCTYPE html>
<html lang="en" data-webtui-theme="catppuccin-mocha">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumenmon Console</title>
    <link rel="stylesheet" href="/css/webtui.css?v={{ v }}">
    <link rel="stylesheet" href="/css/catppuccin.css?v={{ v }}">
    <link rel="stylesheet" href="/css/styles.css?v={{ v }}">
    <script>
        // Global synchronized clock - all timed updates tick together every second
        window.globalClock = {
            callbacks: [],
            register: function(fn) {
                if (!this.callbacks.includes(fn)) {
                    this.callbacks.push(fn);
                }
            },
            unregister: function(fn) {
                const index = this.callbacks.indexOf(fn);
                if (index > -1) {
                    this.callbacks.splice(index, 1);
                }
            },
            tick: function() {
                this.callbacks.forEach(fn => {
                    try {
                        fn();
                    } catch (error) {
                        console.error('Global clock callback error:', error);
                    }
                });
            }
        };
        // Start the global clock
        setInterval(() => window.globalClock.tick(), 1000);
    </script>
</head>
<body>
    <div class="main-content">
        <div class="left-column">
            {% include 'logger.html' %}
            {% include 'table.html' %}
        </div>
        <div class="detail-column">
            <div id="detail-panel" class="detail-panel-empty">
                <span class="detail-placeholder">← Select an agent and press <kbd>Enter</kbd></span>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-left">
            <kbd>↑/k</kbd> <kbd>↓/j</kbd> select · <kbd>enter</kbd> view · <span class="kbd-clickable" onclick="createInvite()" title="click to create invite"><kbd>i</kbd> invite</span> · <span class="kbd-clickable" onclick="fetchAgents(); addLog('manual refresh', 'info');" title="click to refresh"><kbd>r</kbd> refresh</span> · <span class="kbd-clickable" onclick="openDeleteConfirmation()" title="click to delete agent"><kbd>d</kbd> delete</span> · <span class="kbd-clickable" onclick="closeDetailView()" title="click to close detail"><kbd>esc</kbd> close</span>
        </div>
        <div class="footer-right">
            <span class="status-compact" data-tooltip="web: 8080 · mqtt: 8884">console: online</span>
        </div>
    </footer>

    <script src="/js/vendor/chart.js?v={{ v }}"></script>
    {% include 'detail.html' %}
    {% include 'keyboard.html' %}
    {% include 'invite.html' %}
    {% include 'delete_modal.html' %}
</body>
</html>
