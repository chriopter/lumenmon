<!--
Invite creation component with clipboard copy functionality.
Calls /api/invites/create POST endpoint. Functions: createInvite(), copyToClipboard().
-->
<script>
    async function createInvite() {
        addLog('creating invite...', 'info');

        try {
            const response = await fetch('/api/invites/create/full', { method: 'POST' });
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            const data = await response.json();

            if (data.success) {
                // Auto-copy full install command to clipboard
                navigator.clipboard.writeText(data.install_command).then(() => {
                    addLog('install command copied to clipboard', 'success');
                }).catch(err => {
                    console.error('Copy failed:', err);
                    addLog('clipboard copy failed', 'error');
                });

                // Add install command to log as clickable element
                const logEntries = document.getElementById('log-entries');
                const logBox = document.getElementById('log-box');
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                logEntry.innerHTML = `
                    <span class="log-timestamp">[${new Date().toLocaleTimeString('en-US', { hour12: false })}]</span>
                    <span class="invite-url-log" onclick="copyInviteToClipboard(this, \`${data.install_command}\`)" title="click to copy again">
                        ${data.install_command}
                    </span>
                `;
                logEntries.appendChild(logEntry);
                logBox.scrollTop = logBox.scrollHeight;
            } else {
                addLog(`invite creation failed: ${data.error}`, 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            addLog(`invite creation error: ${error.message}`, 'error');
        }
    }

    function copyInviteToClipboard(element, text) {
        navigator.clipboard.writeText(text).then(() => {
            const originalText = element.textContent;
            element.textContent = 'copied!';
            setTimeout(() => { element.textContent = originalText; }, 2000);
            addLog('invite url copied to clipboard', 'info');
        }).catch(err => {
            console.error('Copy failed:', err);
            addLog('clipboard copy failed', 'error');
        });
    }
</script>
