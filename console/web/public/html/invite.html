<!--
Invite creation handler - auto-opens detail view with inline invite display.
SECURITY: Invite URLs stored in RAM only, cleared when agent connects or container restarts.
-->

<script>
    async function createInvite() {
        addLog('creating invite...', 'info');

        try {
            const response = await fetch('/api/invites/create/full', { method: 'POST' });
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            const data = await response.json();

            if (data.success) {
                addLog(`invite created: ${data.username}`, 'success');

                // Refresh agents to show new invite in list
                await fetchAgents();

                // Auto-select and open the new invite's detail view
                setTimeout(() => {
                    const rows = document.querySelectorAll('.agent-row');
                    rows.forEach((row, index) => {
                        if (row.dataset.entityId === data.username) {
                            selectRow(index);
                            openDetailView();
                        }
                    });
                }, 100);
            } else {
                addLog(`invite creation failed: ${data.error}`, 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            addLog(`invite creation error: ${error.message}`, 'error');
        }
    }

</script>
