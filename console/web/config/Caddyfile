# Caddy configuration for Lumenmon Console web interface
# Serves static files from /app/web/public/ and proxies HTML to Flask

:80 {
    # Proxy root to Flask (for HTML rendering)
    handle / {
        reverse_proxy localhost:5000
    }

    # Proxy API requests to Flask
    handle /api/* {
        reverse_proxy localhost:5000
    }

    # Serve static files (CSS, JS) with no-cache headers for development
    handle /css/* {
        root * /app/web/public
        header Cache-Control "no-cache, no-store, must-revalidate"
        header Pragma "no-cache"
        header Expires "0"
        file_server
        encode gzip
    }

    handle /js/* {
        root * /app/web/public
        header Cache-Control "no-cache, no-store, must-revalidate"
        header Pragma "no-cache"
        header Expires "0"
        file_server
        encode gzip
    }

    # Custom error pages
    handle_errors {
        respond "{http.error.status_code} {http.error.status_text}"
    }

    # Logging
    log {
        output stdout
        format console
    }
}
