# Caddy configuration for Lumenmon Console web interface
# Serves static files from /app/web/public/ and proxies HTML to Flask

:80 {
    # Proxy root to Flask (for HTML rendering)
    handle / {
        reverse_proxy localhost:5000
    }

    # Proxy API requests to Flask
    handle /api/* {
        reverse_proxy localhost:5000
    }

    # Serve static files (CSS, JS) - no cache
    handle /css/* {
        root * /app/web/public
        header Cache-Control "no-cache, max-age=0"
        file_server
        encode gzip
    }

    handle /js/* {
        root * /app/web/public
        header Cache-Control "no-cache, max-age=0"
        file_server
        encode gzip
    }

    handle /widgets/* {
        root * /app/web/public
        header Cache-Control "no-cache, max-age=0"
        file_server
        encode gzip
    }

    # Custom error pages
    handle_errors {
        respond "{http.error.status_code} {http.error.status_text}"
    }

    # Logging - temporary file, not in docker logs or persistent storage
    log {
        output file /tmp/caddy.log
        format console
    }
}
