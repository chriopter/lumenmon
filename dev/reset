#!/bin/bash
# Reset lumenmon - clean and rebuild everything

echo "Stopping containers..."
docker stop lumenmon-console lumenmon-agent 2>/dev/null || true
docker rm lumenmon-console lumenmon-agent 2>/dev/null || true

echo "Cleaning data..."
rm -rf agent/data/debug/* agent/data/ssh/* 2>/dev/null || true
rm -rf console/data/agents/id_* console/data/ssh/ssh_host* console/data/*.log 2>/dev/null || true

# Ensure directories exist
mkdir -p agent/data/{debug,ssh} console/data/{agents,ssh}

echo "Starting fresh..."
echo "CONSOLE_HOST=localhost" > console/.env
docker compose -f console/docker-compose.yml up -d --build
CONSOLE_HOST=localhost CONSOLE_PORT=2345 docker compose -f agent/docker-compose.yml up -d --build

echo "Ready! Use ./tui to open dashboard"