name: Update Vendored Dependencies

on:
  # Run weekly on Mondays at 09:00 UTC
  schedule:
    - cron: '0 9 * * 1'

  # Allow manual triggering
  workflow_dispatch:

jobs:
  update-deps:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v6

    - name: Update vendored dependencies
      run: |
        chmod +x ./dev/updatedeps
        ./dev/updatedeps

    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v8
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: |
          chore: update vendored dependencies

          Automated update of vendored web dependencies:
          - Chart.js
          - MQTT.js
        branch: auto/update-deps
        delete-branch: true
        title: 'chore: update vendored dependencies'
        body: |
          ## Automated Dependency Update

          This PR updates vendored web dependencies from unpkg.com CDN:

          - **Chart.js** - Latest version
          - **MQTT.js** - Latest version

          ### What changed?

          Run `./dev/updatedeps` to fetch the latest versions of:
          - `console/web/public/js/vendor/chart.js`
          - `console/web/public/js/vendor/mqtt.min.js`

          > **Note:** CSS is now managed via Tailwind CSS (see `console/package.json`).
          > To update Tailwind: `cd console && npm update tailwindcss @tailwindcss/cli`

          ### Testing

          - [ ] Verify web dashboard loads correctly
          - [ ] Check Chart.js visualizations render properly
          - [ ] Test MQTT live stream (press `L` key)

          ---

          *This PR was automatically generated by the [update-deps workflow](https://github.com/${{ github.repository }}/actions/workflows/update-deps.yml)*
        labels: |
          dependencies
          automated
        assignees: ${{ github.repository_owner }}
